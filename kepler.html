<!DOCTYPE html>
<html>
  <head>
    <title>Kepler Model of the Solar System</title>
    <meta charset="us-ascii">
  </head>

  <body>
    <canvas id="canvas" width="640" height="480">
    </canvas>

    <table id="bodies">
      <tr>
        <th>Body</th>
        <th>Periapsis</th>
        <th>Apoapsis</th>
        <th><i>P</i></th>
        <th><i>M</i></th>
        <th><i>i</i></th>
        <th>&Omega;</th>
        <th>&omega;</th>
      </tr>

      <tr>
        <td>Sol</td>
      </tr>

      <tr>
        <td>Mercury</td>
        <td>0.307499 AU</td>
        <td>0.466697 AU</td>
        <td>87.969 d</td>
        <td>174.796&deg;</td>
        <td>7.005&deg;</td>
        <td>48.331&deg;</td>
        <td>29.124&deg;</td>
      </tr>

      <tr>
        <td>Venus</td>
        <td>0.728213 AU</td>
        <td>0.718440 AU</td>
        <td>224.698 d</td>
        <td>50.115&deg;</td>
        <td>3.39458&deg;</td>
        <td>76.678&deg;</td>
        <td>55.186&deg;</td>
      </tr>

      <tr>
        <td>Earth</td>
        <td>0.98329134 AU</td>
        <td>1.01671388 AU</td>
        <td>365.256363004 d</td>
        <td>357.51716&deg;</td>
        <td>0&deg;</td>
        <td>348.73936&deg;</td>
        <td>114.20783&deg;</td>
      </tr>

      <tr>
        <td>Mars</td>
        <td>1.381497 AU</td>
        <td>1.665861 AU</td>
        <td>686.971 d</td>
        <td>19.3564&deg;</td>
        <td>1.85&deg;</td>
        <td>49.562&deg;</td>
        <td>286.537&deg;</td>
      </tr>

      <tr>
        <td>Vesta</td>
        <td>2.1526 AU</td>
        <td>2.571 AU</td>
        <td>1325.85 d</td>
        <td>307.80&deg;</td>
        <td>7.134&deg;</td>
        <td>103.91&deg;</td>
        <td>149.84&deg;</td>
      </tr>

      <tr>
        <td>Pallas</td>
        <td>2.132 AU</td>
        <td>3.412 AU</td>
        <td>1685.87 d</td>
        <td>96.15&deg;</td>
        <td>34.841&deg;</td>
        <td>173.12&deg;</td>
        <td>310.15&deg;</td>
      </tr>

      <tr>
        <td>Ceres</td>
        <td>2.5468 AU</td>
        <td>2.9858 AU</td>
        <td>1679.67 d</td>
        <td>113.410&deg;</td>
        <td>10.587&deg;</td>
        <td>80.3932&deg;</td>
        <td>72.5898&deg;</td>
      </tr>

      <tr>
        <td>Hygiea</td>
        <td>2.770 AU</td>
        <td>3.507 AU</td>
        <td>2031.01 d</td>
        <td>197.96&deg;</td>
        <td>3.842&deg;</td>
        <td>283.45&deg;</td>
        <td>313.19&deg;</td>
      </tr>

      <tr>
        <td>Jupiter</td>
        <td>4.950429 AU</td>
        <td>5.458104 AU</td>
        <td>4332.59 d</td>
        <td>18.818&deg;</td>
        <td>1.305&deg;</td>
        <td>100.492&deg;</td>
        <td>275.066&deg;</td>
      </tr>

      <tr>
        <td>Saturn</td>
        <td>9.04807635 AU</td>
        <td>10.11595804 AU</td>
        <td>10759.22 d</td>
        <td>320.346750&deg;</td>
        <td>2.48524&deg;</td>
        <td>113.642811&deg;</td>
        <td>336.013862&deg;</td>
      </tr>

      <tr>
        <td>Uranus</td>
        <td>18.37551863 AU</td>
        <td>20.08330526 AU</td>
        <td>30799.095 d</td>
        <td>142.955717&deg;</td>
        <td>0.772556&deg;</td>
        <td>73.989821&deg;</td>
        <td>96.541318&deg;</td>
      </tr>

      <tr>
        <td>Neptune</td>
        <td>29.76607095 AU</td>
        <td>30.44125206 AU</td>
        <td>60190.03 d</td>
        <td>267.767281&deg;</td>
        <td>1.767975&deg;</td>
        <td>131.794310&deg;</td>
        <td>265.646853&deg;</td>
      </tr>

      <tr>
        <td>Pluto</td>
        <td>29.657 AU</td>
        <td>48.871 AU</td>
        <td>89865.65 d</td>
        <td>14.86012204&deg;</td>
        <td>17.151394&deg;</td>
        <td>110.28683&deg;</td>
        <td>113.76349&deg;</td>
      </tr>

      <tr>
        <td>Huya</td>
        <td>28.520 AU</td>
        <td>50.363 AU</td>
        <td>90477 d</td>
        <td>352.38&deg;</td>
        <td>15.487&deg;</td>
        <td>169.40&deg;</td>
        <td>68.169&deg;</td>
      </tr>

      <tr>
        <td>Ixion</td>
        <td>30.091 AU</td>
        <td>49.269 AU</td>
        <td>91295.847 d</td>
        <td>268.546&deg;</td>
        <td>19.584&deg;</td>
        <td>71.028&deg;</td>
        <td>298.779&deg;</td>
      </tr>

      <tr>
        <td>Orcus</td>
        <td>30.27 AU</td>
        <td>48.07 AU</td>
        <td>89552 d</td>
        <td>166.38&deg;</td>
        <td>20.573&deg;</td>
        <td>268.606&deg;</td>
        <td>73.031&deg;</td>
      </tr>

      <tr>
        <td>Haumea</td>
        <td>34.721 AU</td>
        <td>51.544 AU</td>
        <td>103468 d</td>
        <td>202.67&deg;</td>
        <td>28.22&deg;</td>
        <td>121.10&deg;</td>
        <td>239.18&deg;</td>
      </tr>

      <tr>
        <td>Salacia</td>
        <td>37.8383 AU</td>
        <td>46.5395 AU</td>
        <td>100091 d</td>
        <td>113.75&deg;</td>
        <td>23.9396&deg;</td>
        <td>280.1885&deg;</td>
        <td>311.078&deg;</td>
      </tr>

      <tr>
        <td>Makemake</td>
        <td>38.509 AU</td>
        <td>53.074 AU</td>
        <td>113183 d</td>
        <td>85.13&deg;</td>
        <td>28.96&deg;</td>
        <td>79.382&deg;</td>
        <td>298.41&deg;</td>
      </tr>

      <tr>
        <td>Eris</td>
        <td>38.375 AU</td>
        <td>97.65 AU</td>
        <td>204870 d</td>
        <td>202.75388&deg;</td>
        <td>43.844&deg;</td>
        <td>36.051&deg;</td>
        <td>150.809&deg;</td>
      </tr>

      <tr>
        <td>Varuna</td>
        <td>40.494 AU</td>
        <td>45.313 AU</td>
        <td>102646.1 d</td>
        <td>101.764&deg;</td>
        <td>17.2&deg;</td>
        <td>97.303&deg;</td>
        <td>266.736&deg;</td>
      </tr>

      <tr>
        <td>Chaos</td>
        <td>40.929 AU</td>
        <td>50.269 AU</td>
        <td>112898.99415 d</td>
        <td>324.2844&deg;</td>
        <td>12.0550&deg;</td>
        <td>50.0103&deg;</td>
        <td>58.6836&deg;</td>
      </tr>

      <tr>
        <td>Quaoar</td>
        <td>41.695 AU</td>
        <td>45.116 AU</td>
        <td>104451.3 d</td>
        <td>280.554&deg;</td>
        <td>7.996&deg;</td>
        <td>189.033&deg;</td>
        <td>155.624&deg;</td>
      </tr>

      <tr>
        <td>Sedna</td>
        <td>76.361 AU</td>
        <td>937 AU</td>
        <td>4163850 d</td>
        <td>358.01&deg;</td>
        <td>11.927&deg;</td>
        <td>144.26&deg;</td>
        <td>311.02&deg;</td>
      </tr>
    </table>

    <script type="text/javascript">
      "use strict"

      var TWO_PI = 2 * Math.PI

      function trueAnomaly(mean, ecc) {
        /* Convert mean anomaly to eccentric anomaly using three iterations of
         * Newton's method. (Which I assume is good enough?) */
        var e = mean

        e = mean + ecc * Math.sin(e)
        e = mean + ecc * Math.sin(e)
        e = mean + ecc * Math.sin(e)

        /* Convert eccentric anomaly to true anomaly. */
        return 2 * Math.atan2(
          Math.sqrt(1 - ecc) * Math.cos(e * 0.5),
          Math.sqrt(1 + ecc) * Math.sin(e * 0.5)
        )
      }

      function Body(name) {
        this.name = name
      }

      Body.prototype.draw = function(ctx, t) {
        ctx.beginPath()
        ctx.arc(0, 0, 0.5, 0, TWO_PI, true)
        ctx.fill()
      }

      function KeplerBody(name, periapsis, apoapsis, period, meanAnomaly, inclination, longitude, argument) {
        this.name           = name
        this.periapsis      = periapsis
        this.apoapsis       = apoapsis
        this.semimajor      = (apoapsis + periapsis) * 0.5
        this.semiminor      = Math.sqrt(apoapsis * periapsis)
        this.minorToMajor   = this.semiminor / this.semimajor
        this.majorToMinor   = this.semimajor / this.semiminor
        this.eccentricity   = (apoapsis - periapsis) / (apoapsis + periapsis)
        this.offset         = periapsis - this.semimajor
        this.period         = period
        this.meanAnomaly    = meanAnomaly
        this.inclination    = inclination
        this.compression    = Math.cos(inclination)
        this.invCompression = 1 / this.compression
        this.longitude      = longitude
        this.argument       = argument
      }

      KeplerBody.prototype.draw = function(ctx, t) {
        /* FIXME: I added a PI here so that everything would be fastest at the
         * perihelion. Check my math and see if the mean anomalies at epoch
         * come out right. */
        var phi = Math.PI + trueAnomaly(
              this.meanAnomaly + TWO_PI * t / this.period,
              this.eccentricity
            )

        ctx.save()

        ctx.rotate(this.longitude)
        ctx.scale(1, this.compression)
        ctx.rotate(this.argument)
        ctx.translate(this.offset, 0)
        ctx.scale(1, this.minorToMajor)
        ctx.beginPath()
        ctx.arc(0, 0, this.semimajor, 0, TWO_PI, true)
        ctx.stroke()

        ctx.rotate(phi)
        ctx.translate(this.semimajor, 0)
        ctx.rotate(-phi)
        ctx.scale(1, this.majorToMinor)
        ctx.rotate(-this.argument)
        ctx.scale(1, this.invCompression)
        ctx.rotate(-this.longitude)
        Body.prototype.draw.call(this, ctx, t)

        ctx.restore()
      }

      var canvas = document.getElementById("canvas"),
          ctx    = canvas.getContext("2d"),
          table  = document.getElementById("bodies"),
          rows   = table.getElementsByTagName("tr"),
          bodies = [],
          i, cols, start

      for(i = 0; i !== rows.length; ++i) {
        cols = rows[i].getElementsByTagName("td")

        if(cols.length === 1)
          bodies.push(new Body(cols[0].textContent))

        else if(cols.length === 8)
          bodies.push(new KeplerBody(
            cols[0].textContent,
            parseFloat(cols[1].textContent),
            parseFloat(cols[2].textContent),
            parseFloat(cols[3].textContent),
            parseFloat(cols[4].textContent) * Math.PI / -180,
            parseFloat(cols[5].textContent) * Math.PI / -180,
            parseFloat(cols[6].textContent) * Math.PI / -180,
            parseFloat(cols[7].textContent) * Math.PI / -180
          ))
      }

      start = Date.now()
      setInterval(function() {
        var sec = (Date.now() - start) * 0.001

        ctx.clearRect(0, 0, canvas.width, canvas.height)

        ctx.save()
        ctx.translate(canvas.width / 3, canvas.height / 2)
        ctx.scale(4, 4)
        ctx.lineWidth = 0.5 / 4

        for(i = bodies.length; i--; )
          bodies[i].draw(ctx, sec * 365.25)

        ctx.restore()
      }, 1000 / 60)
    </script>
  </body>
</html>

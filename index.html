<!DOCTYPE html>
<html>
  <head>
    <title>Simplified Newtonian Solar System Model</title>
    <meta charset="us-ascii">
  </head>

  <body>
    <canvas id="canvas" width="640" height="480">
    </canvas>

    <script type="text/javascript">
      "use strict"

      var G    = 1.4880826031659495e-34, /* AU^3 * kg^-1 * d^-2 */
          STEP = 0.005

      function Particle(name, mass, x, y, vx, vy, children) {
        this.name = name
        this.mass = mass
        this.x    = x
        this.y    = y
        this.vx   = vx
        this.vy   = vy
        this.ax   = undefined
        this.ay   = undefined
        if(children && children.length)
          this.children = children
      }

      Particle.prototype.reset = function() {
        var i

        this.ax = 0
        this.ay = 0

        if(this.children)
          for(i = this.children.length; i--; )
            this.children[i].reset()
      }

      Particle.prototype.gravitate = function(that) {
        var x = that.x - this.x,
            y = that.y - this.y,
            f = G * this.mass * that.mass * Math.pow(x * x + y * y, -1.5)

        x *= f
        y *= f

        this.ax += x
        this.ay += y
        that.ax -= x
        that.ay -= y
      }

      Particle.prototype.gravitateParents = function(parents) {
        var i

        for(i = parents.length; i--; )
          this.gravitate(parents[i])

        if(this.children) {
          parents.push(this)

          for(i = this.children.length; i--; )
            this.children[i].gravitateParents(parents)

          parents.pop()
        }
      }

      Particle.prototype.resolve = function(dt) {
        var i

        this.x  += this.vx * dt
        this.y  += this.vy * dt
        this.vx += this.ax * dt / this.mass
        this.vy += this.ay * dt / this.mass

        if(this.children)
          for(i = this.children.length; i--; )
            this.children[i].resolve(dt)
      }

      Particle.prototype.update = function(dt) {
        this.reset()
        this.gravitateParents([])
        this.resolve(dt)
      }

      Particle.prototype.draw = function(ctx) {
        var i

        ctx.beginPath()
        ctx.arc(this.x, this.y, Math.log(this.mass) * 0.005, 0, 2 * Math.PI, true)
        ctx.fill()

        if(this.children)
          for(i = this.children.length; i--; )
            this.children[i].draw(ctx)
      }

      var canvas    = document.getElementById("canvas"),
          ctx       = canvas.getContext("2d"),
          system    = new Particle(
            "Sol",
            1.98910e30,
            0.004306786120421, 0.001837532941042,
            -0.000001819959993274, 0.000005304892982043,
            [
              new Particle(
                "Mercury",
                3.30200e23,
                0.260803101047849, 0.194154800478263,
                -0.022403571604671300, 0.023738528365880610
              ),
              new Particle(
                "Venus",
                4.86850e24,
                -0.031638330456358, -0.724079486788030,
                0.020063065336796250, -0.001072254178781860
              ),
              new Particle(
                "Earth",
                5.97360e24,
                -0.176226727277768, 0.968433523644931,
                -0.017195689010009980, -0.003210508555562230,
                [
                  new Particle(
                    "Luna",
                    7.34900e22,
                    -0.178796102519131, 0.967928918272427,
                    -0.017048442635268410, -0.003765966782711167
                  )
                ]
              ),
              new Particle(
                "Mars",
                6.41850e23,
                1.330411586046046, 0.498029360999410,
                -0.004366714270865902, 0.014306132221850870
              ),
              new Particle(
                "Ceres",
                9.43e20,
                2.648457283531522, -1.274796186131166,
                0.004024739385271787, 0.008665634453735570
              ),
              new Particle(
                "Jupiter",
                1.89813e27,
                -5.006795463945934, -2.138374293923735,
                0.002875826974943716, -0.006589043610447228,
                [
                  new Particle(
                    "Io",
                    8.93300e22,
                    -5.008512193291936, -2.136135355673366,
                    -0.005037531455149770, -0.012699969346790770
                  ),
                  new Particle(
                    "Europa",
                    4.79700e22,
                    -5.002337525287256, -2.138505372896449,
                    0.003046656282427492, 0.001387856378147721
                  ),
                  new Particle(
                    "Ganymede",
                    1.48200e23,
                    -5.000295105426739, -2.135367979453066,
                    0.000238327057719573, -0.000895806114936340
                  ),
                  new Particle(
                    "Callisto",
                    1.07600e23,
                    -5.014316678803866, -2.148471570524802,
                    0.006692662546385938, -0.009386503022623945
                  )
                ]
              ),
              new Particle(
                "Saturn",
                5.68319e26,
                7.242418416671252, 5.690983162419947,
                -0.003748446009407056, 0.004375007882123564,
                [
                  new Particle(
                    "Tethys",
                    6.176e20,
                    7.240473327116785, 5.690848464361067,
                    -0.002931797748759508, -0.001466768105420190
                  ),
                  new Particle(
                    "Dione",
                    1.09572e21,
                    7.242265728924768, 5.693216716959230,
                    -0.009515930779839659, 0.004282686571899357
                  ),
                  new Particle(
                    "Rhea",
                    2.309e21,
                    7.245697542452135, 5.689741110633067,
                    -0.002019680126147410, 0.008372160410501973
                  ),
                  new Particle(
                    "Titan",
                    1.34553e23,
                    7.244673448043061, 5.697951698056964,
                    -0.006773622791592816, 0.005340189721916555
                  ),
                  new Particle(
                    "Iapetus",
                    1.8059e21,
                    7.218499061409521, 5.694199530936897,
                    -0.003920120168030774, 0.002610400437786085
                  )
                ]
              ),
              new Particle(
                "Uranus",
                8.68103e25,
                -18.20862254124535, -1.932683895494710,
                0.000385947272031681, -0.004094768048725593,
                [
                  new Particle(
                    "Ariel",
                    1.353e21,
                    -18.20986983489917, -1.932421448421733,
                    0.0002870602183403436, -0.003636590989186473
                  ),
                  new Particle(
                    "Umbriel",
                    1.172e21,
                    -18.20733435454978, -1.933125865627027,
                    -0.001384518283653829, -0.003990056531853695
                  ),
                  new Particle(
                    "Titania",
                    3.527e21,
                    -18.21045923297376, -1.931976498041417,
                    0.001959043851467549, -0.004243193567039912
                  ),
                  new Particle(
                    "Oberon",
                    3.014e21,
                    -18.21188693726248, -1.931707298692171,
                    0.001308857272378922, -0.004075106342393159
                  )
                ]
              ),
              new Particle(
                "Neptune",
                1.02410e26,
                -15.55789222286065, -26.00846751987677,
                0.002674516667751287, -0.001593015512290728,
                [
                  new Particle(
                    "Triton",
                    2.14700e22,
                    -15.55623909521265, -26.00918305605782,
                    0.001085754102362194, -0.003360665650946588
                  )
                ]
              ),
              new Particle(
                "Pluto",
                1.31400e22,
                -30.41814872632992, 2.124378897522244,
                0.000365253253353883, -0.003322858459787869,
                [
                  new Particle(
                    "Charon",
                    1.90e21,
                    -30.41812219844931, 2.124466093634597,
                    0.0004561435258701533, -0.003270325488660776
                  )
                ]
              ),
              new Particle(
                "Haumea",
                4.006e21,
                -45.16975478244534, 17.23469296548250,
                -0.0006363860170478608, -0.001919736978890094
              ),
              new Particle(
                "Makemake",
                3e21,
                -30.38432626447649, 30.202692332311373,
                -0.001679102652152304, -0.001529039489236426
              ),
              new Particle(
                "Eris",
                1.67000e22,
                88.85317615801596, 19.63231277532461,
                0.000113347345216870, 0.001056834242451327
              ),
              new Particle(
                "Sedna",
                1e21,
                85.26352517444057, 52.78818888136040,
                -0.001995305274158005, 0.001109575368548437
              )
            ]
          ),
          t1 = Date.now()

      function update(dt) {
        while(dt > STEP) {
          system.update(STEP)
          dt -= STEP
        }

        if(dt > 0)
          system.update(dt)
      }

      function draw(ctx) {
        ctx.save()
        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)
        ctx.translate(ctx.canvas.width * 0.333, ctx.canvas.height * 0.5)
        ctx.scale(4, -4)
        system.draw(ctx)
        ctx.restore()
      }

      setInterval(function() {
        var t2 = Date.now()
        update((t2 - t1) * 0.001)
        t1 = t2
      }, 1)

      setInterval(function() {
        draw(ctx)
      }, 1000 / 60)
    </script>
  </body>
</html>
